<script>
    // é…ç½®å¯¹è±¡
const config = {
    $quark: {
        api: {
            ua: {
                downloadLink: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) quark-cloud-drive/2.5.20 Chrome/100.0.4896.160 Electron/18.3.5.4-b478491100 Safari/537.36 Channel/pckk_other_ch"
            },
            getLink: "https://drive.quark.cn/1/clouddrive/file/download?pr=ucpro&fr=pc"
        },
        mount: {
            home: ".btn-operate .btn-main",
            share: ".share-btns"
        },
        dom: {
            enhance: `+<br/>æ­¤æ–¹å¼ä¸‹è½½ä¸ä¼šè¢« IDM æ•è·ä¸‹è½½é“¾æ¥`,
            normal: `+<br/>æ­¤æ–¹å¼ä¸‹è½½æœ‰å¯èƒ½ä¼šè¢« IDM æ•è·ä¸‹è½½é“¾æ¥`
        }
    }
};

// æ¨¡æ‹Ÿ base.post å‡½æ•°
const base = {
    async post(url, data, headers) {
        console.log('ğŸš€ å‘é€è¯·æ±‚åˆ°:', url);
        console.log('ğŸ“¤ è¯·æ±‚æ•°æ®:', data);
        console.log('ğŸ“‹ è¯·æ±‚å¤´:', headers);
        
        // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));
        
        // æ¨¡æ‹Ÿè¿”å›æ•°æ®
        const mockResponse = {
            status: 200,
            data: {
                code: 0,
                message: "success",
                data: data.fids.map(fid => ({
                    fid: fid,
                    download_url: `https://drive.quark.cn/download/${fid}?token=mock_token_${Math.random().toString(36).substr(2, 9)}`,
                    filename: `æ–‡ä»¶_${fid}.zip`,
                    size: Math.floor(Math.random() * 1000000) + 1000000, // 1MB-2MB
                    expire_time: Date.now() + 3600000 // 1å°æ—¶åè¿‡æœŸ
                }))
            }
        };
        
        // æ¨¡æ‹Ÿå¯èƒ½çš„é”™è¯¯æƒ…å†µ
        if (Math.random() < 0.1) { // 10% æ¦‚ç‡è¿”å›é”™è¯¯
            throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
        }
        
        return mockResponse;
    }
};

/**
 * è·å–å¤¸å…‹äº‘ç›˜æ–‡ä»¶ä¸‹è½½é“¾æ¥
 * @param {string[]} fids - æ–‡ä»¶IDåˆ—è¡¨
 * @returns {Promise<Array>} ä¸‹è½½é“¾æ¥åˆ—è¡¨
 */
async function getQuarkDownloadLinks(fids) {
    try {
        console.log('ğŸ“ å¼€å§‹è·å–ä¸‹è½½é“¾æ¥ï¼Œæ–‡ä»¶æ•°é‡:', fids.length);
        console.log('ğŸ“‹ æ–‡ä»¶IDåˆ—è¡¨:', fids);
        
        // è°ƒç”¨ API
        let res = await base.post(
            config.$quark.api.getLink, 
            { "fids": fids }, 
            { 
                "content-type": "application/json;charset=utf-8", 
                "user-agent": config.$quark.api.ua.downloadLink 
            }
        );
        
        // æ£€æŸ¥å“åº”çŠ¶æ€
        if (res.status !== 200) {
            throw new Error(`HTTP çŠ¶æ€ç é”™è¯¯: ${res.status}`);
        }
        
        // æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç 
        if (res.data.code !== 0) {
            throw new Error(`ä¸šåŠ¡é”™è¯¯: ${res.data.message}`);
        }
        
        // æå–ä¸‹è½½é“¾æ¥åˆ—è¡¨
        const downloadLinks = res.data;
        
        // è¾“å‡ºç»“æœ
        console.log('âœ… æˆåŠŸè·å–ä¸‹è½½é“¾æ¥:');
        console.log('=' * 50);
        downloadLinks.forEach((item, index) => {
            console.log(`ğŸ“ æ–‡ä»¶ ${index + 1}:`);
            console.log(`   FID: ${item.fid}`);
            console.log(`   æ–‡ä»¶å: ${item.filename}`);
            console.log(`   å¤§å°: ${(item.size / 1024 / 1024).toFixed(2)} MB`);
            console.log(`   ä¸‹è½½é“¾æ¥: ${item.download_url}`);
            console.log(`   è¿‡æœŸæ—¶é—´: ${new Date(item.expire_time).toLocaleString()}`);
            console.log('---');
        });
        copyToClipboard(downloadLinks.map(item => item.download_url).join('\n'));
        return downloadLinks;
        
    } catch (error) {
        console.error('âŒ è·å–ä¸‹è½½é“¾æ¥å¤±è´¥:', error.message);
        return [];
    }
}

/**
 * æ‰¹é‡å¤„ç†æ–‡ä»¶IDï¼Œæ”¯æŒå¤§é‡æ–‡ä»¶åˆ†æ‰¹å¤„ç†
 * @param {string[]} fids - æ–‡ä»¶IDåˆ—è¡¨
 * @param {number} batchSize - æ¯æ‰¹å¤„ç†çš„æ–‡ä»¶æ•°é‡
 * @returns {Promise<Array>} æ‰€æœ‰ä¸‹è½½é“¾æ¥åˆ—è¡¨
 */
async function getQuarkDownloadLinksBatch(fids, batchSize = 50) {
    const allLinks = [];
    
    console.log(`ğŸ”„ å¼€å§‹æ‰¹é‡å¤„ç†ï¼Œæ€»æ–‡ä»¶æ•°: ${fids.length}ï¼Œæ¯æ‰¹: ${batchSize}`);
    
    for (let i = 0; i < fids.length; i += batchSize) {
        const batch = fids.slice(i, i + batchSize);
        const batchNumber = Math.floor(i / batchSize) + 1;
        const totalBatches = Math.ceil(fids.length / batchSize);
        
        console.log(`ğŸ“¦ å¤„ç†ç¬¬ ${batchNumber}/${totalBatches} æ‰¹ï¼Œæ–‡ä»¶ ${i + 1}-${Math.min(i + batchSize, fids.length)}`);
        
        try {
            const links = await getQuarkDownloadLinks(batch);
            allLinks.push(...links);
            
            // æ‰¹æ¬¡é—´å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
            if (i + batchSize < fids.length) {
                console.log('â±ï¸  ç­‰å¾… 1 ç§’åå¤„ç†ä¸‹ä¸€æ‰¹...');
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        } catch (error) {
            console.error(`âŒ ç¬¬ ${batchNumber} æ‰¹å¤„ç†å¤±è´¥:`, error.message);
        }
    }
    
    console.log(`ğŸ‰ æ‰¹é‡å¤„ç†å®Œæˆï¼Œå…±è·å– ${allLinks.length} ä¸ªä¸‹è½½é“¾æ¥`);
    return allLinks;
}

// ä½¿ç”¨ç¤ºä¾‹
async function example() {
    // ç¤ºä¾‹æ–‡ä»¶IDåˆ—è¡¨
    const testFids = [
        "file_id_001",
        "file_id_002", 
        "file_id_003",
        "file_id_004",
        "file_id_005"
    ];
    
    console.log('ğŸ¯ å¼€å§‹æµ‹è¯•è·å–ä¸‹è½½é“¾æ¥...');
    
    // æ–¹å¼1ï¼šç›´æ¥è·å–
    const links1 = await getQuarkDownloadLinks(testFids);
    console.log('\nğŸ“Š æ–¹å¼1ç»“æœ:', links1.length, 'ä¸ªé“¾æ¥');
    
    // æ–¹å¼2ï¼šæ‰¹é‡å¤„ç†ï¼ˆé€‚åˆå¤§é‡æ–‡ä»¶ï¼‰
    const manyFids = Array.from({length: 120}, (_, i) => `file_id_${String(i + 1).padStart(3, '0')}`);
    const links2 = await getQuarkDownloadLinksBatch(manyFids, 30);
    console.log('\nğŸ“Š æ–¹å¼2ç»“æœ:', links2.length, 'ä¸ªé“¾æ¥');
}

      function copyToClipboard  (text) {
            console.log("å¤åˆ¶åˆ°å‰ªè´´æ¿:", text);
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        };
// å°†å‡½æ•°æ·»åŠ åˆ°æ‚¨çš„ç°æœ‰ä»£ç ä¸­
$(document).ready(function() {
    // æ‚¨çš„ç°æœ‰ä»£ç ...
    
 
    

});
</script>